<!DOCTYPE html>
<html lang="en" ng-app="collageapp">
	<head>
		<title>Venice Missing Treasures Collage</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		
		<!-- Firebase -->
		<script type='text/javascript' src='https://cdn.firebase.com/v0/firebase.js'></script>
		
		<!-- jquery -->
		<!--[if lt IE 9]>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<![endif]-->
		<!--[if (gte IE 9) | (!IE)]><!-->
		<!--script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js" type="text/javascript"></script>
		<!--<![endif]-->
	
		<!--[if IE]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
		<!-- Leaflet -->
		<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
		
		<!-- bootstrap -->
		<!--link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css"/>
		<script type='text/javascript' src='js/bootstrap.min.js'></script-->
		
		<!-- angularjs -->
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js"></script>
		
		<!-- angular slider -->
		<!--link rel="stylesheet" type="text/css" href="css/angular-slider.min.css"/>
		<script type='text/javascript' src='js/angular-slider.min.js'></script>--
		
		<!-- spinner -->
		<!--script type='text/javascript' src='js/spin.min.js'></script>
		<script type='text/javascript' src='js/jquery.spin.js'></script-->
		
		<!-- imagesLoaded -->
		<script src="http://imagesloaded.desandro.com/imagesloaded.pkgd.min.js" type="text/javascript"></script>
		
		
		<!-- local css -->
		<!--link rel="stylesheet" type="text/css" href="css/main.css"/-->
		
		<!-- console library -->
		<script type='text/javascript' src='javascripts/ck-console.js'></script>
		
		<link rel="stylesheet" type="text/css" href="css/transitions.css" media="all" />
		<link rel="stylesheet" type="text/css" href="css/collageTags.css" media="all" />
		<link rel="stylesheet" type="text/css" href="css/collageOverlay.css" media="all" />
	
		<script src="javascripts/jquery-collagePlus/jquery.collagePlus.js"></script>
		<script src="javascripts/jquery-collagePlus/jquery.removeWhitespace.js"></script>
		<script src="javascripts/jquery-collagePlus/jquery.collageCaption.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
		<!--script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/fancybox/1.3.4/jquery.fancybox-1.3.4.pack.min.js"></script-->
		
		<!-- Data load methods -->
		<script type="text/javascript" src='javascripts/dataLoad.js'></script>
	
		<script type="text/javascript">
			console.log("Loading Head script");
			// All images need to be loaded for this plugin to work so
			// we end up waiting for the whole window to load in this example
			/*$(window).load(function () {
				$(document).ready(function(){
					console.log("Document Ready");
					//collage();
					//$('.Collage').collageCaption();
				});
			});*/
		
		
			// Here we apply the actual CollagePlus plugin
			function collage() {
				$('.Collage').removeWhitespace().collagePlus(
					{
						'fadeSpeed'	 : 2000,
						'targetHeight'  : 250,
						'allowPartialLastRow' : true
					}
				);
			};
		
			// This is just for the case that the browser window is resized
			var resizeTimer = null;
			$(window).bind('resize', function() {
				// hide all the images until we resize them
				$('.Collage .Image_Wrapper').css("opacity", 0);
				// set a timer to re-apply the plugin
				if (resizeTimer) clearTimeout(resizeTimer);
				resizeTimer = setTimeout(collage, 200);
			});

		</script>
	</head>
	<body ng-controller="DataCtrl">
		<header class="header">
			<script type="text/javascript">
				function getTags(){
					var text = self.location.search;
					if(text == "")return [];
					var theleft = text.lastIndexOf("?") + 1;
					return text.substring(theleft, text.length).split(',');
				}
				var tags = getTags();
				
				function toggleTag(tagName){
					console.log("Toggle Tag");
					var i = tags.indexOf(tagName);
					if(i != -1) {
						tags.splice(i, 1);
						window.location.href = 'index.html?' + tags;
						return;
					}
					tags[tags.length] = tagName;
					window.location.href = 'index.html?' + tags;
				}
				
				function NavCtrl($scope){
					/**
					 * Holds the data for the NavTag
					 * @param <String> name The nav button to add
					 */
					function NavTag(name){
						this.name = name;
						this.loadedTag = (tags.indexOf(name) != -1 ? 'selected' : '');
					}
					//The list of nav tags to have
					$scope.allNavs = [
						new NavTag("Art"),
						new NavTag("Churches")
					];
					$scope.toggleTagName = toggleTag;
				}
			</script>
			<!-- Dynamically add more nav tags using a repeat rule -->
			<nav ng-controller="NavCtrl">
				<a href="index.html">All</a>
				<a ng-repeat="navTag in allNavs" class="{{navTag.loadedTag}}" href="#" ng-click="toggleTagName(navTag.name);">{{navTag.name}}</a>
			</nav>
		</header>
		
		<!-- This is where the images get stored once loaded -->
		<section id="image_container" class="Collage effect-parent">
			<div ng-repeat="image in allImages" class="Image_Wrapper" data-caption="{{image.caption}}">
				<a ng-switch on="{{image.sizeDefined}}">
					<img ng-switch-when="true" ng-src="{{image.image}}" width="{{image.width}}" height="{{image.height}}"></img>
					<img ng-switch-default ng-src="{{image.image}}"></img>
				</a>
			</div>
		</section>
		
		
		<script type="text/javascript">
			//Function that truncates strings down to a specific length and adds '...' to the end
			String.prototype.trunc =
				function(n,useWordBoundary){
					var toLong = this.length>n,
					s_ = toLong ? this.substr(0,n-1) : this;
					s_ = useWordBoundary && toLong ? s_.substr(0,s_.lastIndexOf(' ')) : s_;
			 		return  toLong ? s_ + '&hellip;' : s_;
				};
			
			
			/*
			 * Holds the data to display for a given image in the collage
			 * @param {String} title The title of the peice of work
			 * @param {Number} date The date associated with this peice
			 * @param {String} caption The caption to display on this image
			 * @param {String} image The URL for the image to load
			 */
			function ImageWrapper(title, date, caption, image, width, height){
				this.title = title;
				this.date = date;
				this.caption = '<b>' + title + '</b><br>' + caption.trunc(100, true);
				this.image = image;
				if(typeof(width)!=='undefined'){
					if(typeof(height) ==='undefined'){
						throw "If you define height you must define the weight";
					}
					this.height = height;
					this.width  = width;
					this.sizeDefined = true;
				} else {
					this.sizeDefined = false;
				}
			}
			
			
			/*
			 * Hard coded images.
			 * This is done becasue we don't currenly have CK-console data entries
			 * for these peices.
			 */
			var images = [];
			var tags = getTags();
			if( tags.indexOf('Art') != -1 || tags.length == 0){
				console.log("Loading art images into the array");
				images = [
					new ImageWrapper('The Adoration of the Kings',
						1573,
						'The picture is dated 1573 in Roman numerals on the lowest step (bottom right). It was painted for the church of S. Silvestro in Venice, where it remained until the church was altered in the 19th century. It was not an altarpiece but a large painting for the wall of the nave beside the altar of the confraternity dedicated toSaint Joseph.',
						'https://upload.wikimedia.org/wikipedia/commons/2/20/Jan_Gossaert_001.jpg',
						3840,
						4226),
					new ImageWrapper('The Wedding at Cana',
						1563,
						'The piece was commissioned in 1562 by the Benedictine Monastery of San Giorgio Maggiore in Venice, Italy, and completed in fifteen months by the year 1563. It hung in the refectory of the monastery for 235 years, until it was plundered by Napoleonin 1797 and shipped to Paris. The painting was cut in half for the journey and stitched back together in Paris. It was not returned in the post-Napoleonic conciliation treaties which pursued some restitution of looted artworks',
						'https://upload.wikimedia.org/wikipedia/commons/e/e0/Paolo_Veronese_008.jpg',
						755,
						513),
					new ImageWrapper('Feast in the House of Levi',
						1573,
						'It was painted by Veronese for the rear wall of the refectory of the Basilica di Santi Giovanni e Paolo, a Dominican friary, as a Last Supper, to replace an earlier work by Titian destroyed in the fire of 1571.',
						'https://upload.wikimedia.org/wikipedia/commons/f/f1/Paolo_Veronese_007.jpg',
						1155,
						513),
					new ImageWrapper('Enthroned Madonna and Child',
						1562,
						'Was painted for the Sacristy of the Venetian Renaissance church of San Zaccaria (restored in 1562). It is a fine example of the early works of Veronese with its harmonious richness of colour. Now in Accademia.',
						'https://upload.wikimedia.org/wikipedia/en/7/7f/Lippi_Madonna_Tarquinia.jpg',
						292,
						513),
					new ImageWrapper('Four Allegories of Love: Respect, Scorn, Unfaithfulness, Happy Union',
						1575,
						'They were probably made to decorate a ceiling and form a complete series. We do not know who commissioned them, but their presence in 1648 in the Prague Castle suggests that it may have been one of the Holy Roman Emperors, Ferdinand I (died 1564) or Maximilian II (died 1576), or a wealthy patron at the court. Alternatively, they may have been painted for a location in Venice, as two details from them are recorded in the famous sketchbook that Van Dyck kept in Italy between 1621 and 1627.',
						'https://upload.wikimedia.org/wikipedia/commons/b/b2/Paolo_Veronese_020.jpg',
						513,
						513),
					new ImageWrapper('The Family of Darius at the Feet of Alexander',
						1565,
						'In Venice at some point. Now in the National Gallery of London.',
						'https://upload.wikimedia.org/wikipedia/commons/5/56/Paolo_Veronese_-_The_Family_of_Darius_before_Alexander_-_Google_Art_Project.jpg',
						1057,
						513)
				];
			} // endif
			
			loadData(images, getTags());
			
		</script>
	</body>
</html>	