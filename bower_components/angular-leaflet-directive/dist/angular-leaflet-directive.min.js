/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive Team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-leaflet-directive
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-leaflet-directive 27-10-2014 */
(function(){"use strict";angular.module("leaflet-directive",[]).directive("leaflet",["$q","leafletData","leafletMapDefaults","leafletHelpers","leafletEvents",function(e,t,n,r,i){var s;return{restrict:"EA",replace:true,scope:{center:"=center",defaults:"=defaults",maxbounds:"=maxbounds",bounds:"=bounds",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",layers:"=layers",controls:"=controls",decorations:"=decorations",eventBroadcast:"=eventBroadcast"},transclude:true,template:'<div class="angular-leaflet-map"><div ng-transclude></div></div>',controller:["$scope",function(t){s=e.defer();this.getMap=function(){return s.promise};this.getLeafletScope=function(){return t}}],link:function(e,o,u){function h(){if(isNaN(u.width)){o.css("width",u.width)}else{o.css("width",u.width+"px")}}function p(){if(isNaN(u.height)){o.css("height",u.height)}else{o.css("height",u.height+"px")}}var a=r.isDefined,f=n.setDefaults(e.defaults,u.id),l=i.genDispatchMapEvent,c=i.getAvailableMapEvents();if(a(u.width)){h();e.$watch(function(){return o[0].getAttribute("width")},function(){h();d.invalidateSize()})}if(a(u.height)){p();e.$watch(function(){return o[0].getAttribute("height")},function(){p();d.invalidateSize()})}var d=new L.Map(o[0],n.getMapCreationDefaults(u.id));s.resolve(d);if(!a(u.center)){d.setView([f.center.lat,f.center.lng],f.center.zoom)}if(!a(u.tiles)&&!a(u.layers)){var v=L.tileLayer(f.tileLayer,f.tileLayerOptions);v.addTo(d);t.setTiles(v,u.id)}if(a(d.zoomControl)&&a(f.zoomControlPosition)){d.zoomControl.setPosition(f.zoomControlPosition)}if(a(d.zoomControl)&&f.zoomControl===false){d.zoomControl.removeFrom(d)}if(a(d.zoomsliderControl)&&a(f.zoomsliderControl)&&f.zoomsliderControl===false){d.zoomsliderControl.removeFrom(d)}if(!a(u.eventBroadcast)){var m="broadcast";for(var g=0;g<c.length;g++){var y=c[g];d.on(y,l(e,y,m),{eventName:y})}}d.whenReady(function(){t.setMap(d,u.id)});e.$on("$destroy",function(){d.remove();t.unresolveMap(u.id)});e.$on("invalidateSize",function(){d.invalidateSize()})}}}]);angular.module("leaflet-directive").directive("center",["$log","$q","$location","$timeout","leafletMapDefaults","leafletHelpers","leafletBoundsHelpers","leafletEvents",function(e,t,n,r,i,s,o,u){var a=s.isDefined,f=s.isNumber,l=s.isSameCenterOnMap,c=s.safeApply,h=s.isValidCenter,p=s.isEmpty,d=s.isUndefinedOrEmpty;var v=function(e,t){return a(e)&&!p(e)&&d(t)};var m;return{restrict:"A",scope:false,replace:false,require:"leaflet",controller:function(){m=t.defer();this.getCenter=function(){return m.promise}},link:function(t,s,p,d){var g=d.getLeafletScope(),y=g.center;d.getMap().then(function(s){var d=i.getDefaults(p.id);if(p.center.search("-")!==-1){e.error('The "center" variable can\'t use a "-" on his key name: "'+p.center+'".');s.setView([d.center.lat,d.center.lng],d.center.zoom);return}else if(v(g.bounds,y)){s.fitBounds(o.createLeafletBounds(g.bounds));y=s.getCenter();c(g,function(e){e.center={lat:s.getCenter().lat,lng:s.getCenter().lng,zoom:s.getZoom(),autoDiscover:false}});c(g,function(e){var t=s.getBounds();var n={northEast:{lat:t._northEast.lat,lng:t._northEast.lng},southWest:{lat:t._southWest.lat,lng:t._southWest.lng}};e.bounds=n})}else if(!a(y)){e.error('The "center" property is not defined in the main scope');s.setView([d.center.lat,d.center.lng],d.center.zoom);return}else if(!(a(y.lat)&&a(y.lng))&&!a(y.autoDiscover)){angular.copy(d.center,y)}var b,w;if(p.urlHashCenter==="yes"){var E=function(){var e=n.search();var t;if(a(e.c)){var r=e.c.split(":");if(r.length===3){t={lat:parseFloat(r[0]),lng:parseFloat(r[1]),zoom:parseInt(r[2],10)}}}return t};b=E();g.$on("$locationChangeSuccess",function(e){var t=e.currentScope;var n=E();if(a(n)&&!l(n,s)){t.center={lat:n.lat,lng:n.lng,zoom:n.zoom}}})}g.$watch("center",function(t){if(a(b)){angular.copy(b,t);b=undefined}if(!h(t)&&t.autoDiscover!==true){e.warn("[AngularJS - Leaflet] invalid 'center'");return}if(t.autoDiscover===true){if(!f(t.zoom)){s.setView([d.center.lat,d.center.lng],d.center.zoom)}if(f(t.zoom)&&t.zoom>d.center.zoom){s.locate({setView:true,maxZoom:t.zoom})}else if(a(d.maxZoom)){s.locate({setView:true,maxZoom:d.maxZoom})}else{s.locate({setView:true})}return}if(w&&l(t,s)){return}g.settingCenterFromScope=true;s.setView([t.lat,t.lng],t.zoom);u.notifyCenterChangedToBounds(g,s);r(function(){g.settingCenterFromScope=false})},true);s.whenReady(function(){w=true});s.on("moveend",function(){m.resolve();u.notifyCenterUrlHashChanged(g,s,p,n.search());if(l(y,s)||t.settingCenterFromScope){return}c(g,function(e){if(!g.settingCenterFromScope){e.center={lat:s.getCenter().lat,lng:s.getCenter().lng,zoom:s.getZoom(),autoDiscover:false}}u.notifyCenterChangedToBounds(g,s)})});if(y.autoDiscover===true){s.on("locationerror",function(){e.warn("[AngularJS - Leaflet] The Geolocation API is unauthorized on this page.");if(h(y)){s.setView([y.lat,y.lng],y.zoom);u.notifyCenterChangedToBounds(g,s)}else{s.setView([d.center.lat,d.center.lng],d.center.zoom);u.notifyCenterChangedToBounds(g,s)}})}})}}}]);angular.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(e,t,n,r){return{restrict:"A",scope:false,replace:false,require:"leaflet",link:function(i,s,o,u){var a=r.isDefined,f=u.getLeafletScope(),l=f.tiles;if(!a(l)&&!a(l.url)){e.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property.");return}u.getMap().then(function(e){var r=n.getDefaults(o.id);var i;f.$watch("tiles",function(n){var s=r.tileLayerOptions;var u=r.tileLayer;if(!a(n.url)&&a(i)){e.removeLayer(i);return}if(!a(i)){if(a(n.options)){angular.copy(n.options,s)}if(a(n.url)){u=n.url}i=L.tileLayer(u,s);i.addTo(e);t.setTiles(i,o.id);return}if(a(n.url)&&a(n.options)&&!angular.equals(n.options,s)){e.removeLayer(i);s=r.tileLayerOptions;angular.copy(n.options,s);u=n.url;i=L.tileLayer(u,s);i.addTo(e);t.setTiles(i,o.id);return}if(a(n.url)){i.setUrl(n.url)}},true)})}}}]);angular.module("leaflet-directive").directive("legend",["$log","$http","leafletHelpers","leafletLegendHelpers",function(e,t,n,r){return{restrict:"A",scope:false,replace:false,require:"leaflet",link:function(i,s,o,u){var a=n.isArray,f=n.isDefined,l=n.isFunction,c=u.getLeafletScope(),h=c.legend;var p=h.legendClass?h.legendClass:"legend";var d=h.position||"bottomright";var v;u.getMap().then(function(n){c.$watch("legend",function(t){if(!f(t.url)&&(!a(t.colors)||!a(t.labels)||t.colors.length!==t.labels.length)){e.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")}else if(f(t.url)){e.info("[AngularJS - Leaflet] loading arcgis legend service.")}else{if(f(v)){v.removeFrom(n)}v=L.control({position:d});v.onAdd=r.getOnAddArrayLegend(t,p);v.addTo(n)}});c.$watch("legend.url",function(i){if(!f(i)){return}t.get(i).success(function(e){if(f(v)){r.updateArcGISLegend(v.getContainer(),e)}else{v=L.control({position:d});v.onAdd=r.getOnAddArcGISLegend(e,p);v.addTo(n)}if(f(h.loadedData)&&l(h.loadedData)){h.loadedData()}}).error(function(){e.warn("[AngularJS - Leaflet] legend.url not loaded.")})})})}}}]);angular.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData","leafletHelpers",function(e,t,n,r){return{restrict:"A",scope:false,replace:false,require:"leaflet",link:function(e,i,s,o){var u=r.safeApply,a=r.isDefined,f=o.getLeafletScope(),l={};o.getMap().then(function(e){f.$watch("geojson",function(i){if(a(l)&&e.hasLayer(l)){e.removeLayer(l)}if(!(a(i)&&a(i.data))){return}var o=i.resetStyleOnMouseout,c=i.onEachFeature;if(!c){c=function(e,n){if(r.LabelPlugin.isLoaded()&&a(i.label)){n.bindLabel(e.properties.description)}n.on({mouseover:function(n){u(f,function(){i.selected=e;t.$broadcast("leafletDirectiveMap.geojsonMouseover",n)})},mouseout:function(e){if(o){l.resetStyle(e.target)}u(f,function(){i.selected=undefined;t.$broadcast("leafletDirectiveMap.geojsonMouseout",e)})},click:function(n){u(f,function(){i.selected=e;t.$broadcast("leafletDirectiveMap.geojsonClick",i.selected,n)})}})}}i.options={style:i.style,filter:i.filter,onEachFeature:c,pointToLayer:i.pointToLayer};l=L.geoJson(i.data,i.options);n.setGeoJSON(l,s.id);l.addTo(e)})})}}}]);angular.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletLayerHelpers","leafletControlHelpers",function(e,t,n,r,i,s){var o;return{restrict:"A",scope:false,replace:false,require:"leaflet",controller:function(){o=t.defer();this.getLayers=function(){return o.promise}},link:function(t,u,a,f){var l=r.isDefined,c={},h=f.getLeafletScope(),p=h.layers,d=i.createLayer,v=s.updateLayersControl,m=false;f.getMap().then(function(t){if(!l(p)||!l(p.baselayers)||Object.keys(p.baselayers).length===0){e.error("[AngularJS - Leaflet] At least one baselayer has to be defined");return}o.resolve(c);n.setLayers(c,a.id);c.baselayers={};c.overlays={};var r=a.id;var i=false;for(var s in p.baselayers){var u=d(p.baselayers[s]);if(!l(u)){delete p.baselayers[s];continue}c.baselayers[s]=u;if(p.baselayers[s].top===true){t.addLayer(c.baselayers[s]);i=true}}if(!i&&Object.keys(c.baselayers).length>0){t.addLayer(c.baselayers[Object.keys(p.baselayers)[0]])}for(s in p.overlays){if(p.overlays[s].type==="cartodb"){}var f=d(p.overlays[s]);if(!l(f)){delete p.overlays[s];continue}c.overlays[s]=f;if(p.overlays[s].visible===true){t.addLayer(c.overlays[s])}}h.$watch("layers.baselayers",function(n){for(var i in c.baselayers){if(!l(n[i])){if(t.hasLayer(c.baselayers[i])){t.removeLayer(c.baselayers[i])}delete c.baselayers[i]}}for(var s in n){if(!l(c.baselayers[s])){var o=d(n[s]);if(l(o)){c.baselayers[s]=o;if(n[s].top===true){t.addLayer(c.baselayers[s])}}}}if(Object.keys(c.baselayers).length===0){e.error("[AngularJS - Leaflet] At least one baselayer has to be defined");return}var u=false;for(var a in c.baselayers){if(t.hasLayer(c.baselayers[a])){u=true;break}}if(!u){t.addLayer(c.baselayers[Object.keys(p.baselayers)[0]])}m=v(t,r,m,n,p.overlays,c)},true);h.$watch("layers.overlays",function(e){for(var n in c.overlays){if(!l(e[n])){if(t.hasLayer(c.overlays[n])){t.removeLayer(c.overlays[n])}delete c.overlays[n]}}for(var i in e){if(!l(c.overlays[i])){var s=d(e[i]);if(l(s)){c.overlays[i]=s;if(e[i].visible===true){t.addLayer(c.overlays[i])}}}if(e[i].visible&&!t.hasLayer(c.overlays[i])){t.addLayer(c.overlays[i])}else if(e[i].visible===false&&t.hasLayer(c.overlays[i])){t.removeLayer(c.overlays[i])}}m=v(t,r,m,p.baselayers,e,c)},true)})}}}]);angular.module("leaflet-directive").directive("bounds",["$log","$timeout","leafletHelpers","leafletBoundsHelpers",function(e,t,n,r){return{restrict:"A",scope:false,replace:false,require:["leaflet","center"],link:function(i,s,o,u){var a=n.isDefined,f=r.createLeafletBounds,l=u[0].getLeafletScope(),c=u[0];var h=function(e){if(e._southWest.lat===0&&e._southWest.lng===0&&e._northEast.lat===0&&e._northEast.lng===0){return true}return false};c.getMap().then(function(n){l.$on("boundsChanged",function(e){var t=e.currentScope;var r=n.getBounds();if(h(r)||t.settingBoundsFromScope){return}var i={northEast:{lat:r._northEast.lat,lng:r._northEast.lng},southWest:{lat:r._southWest.lat,lng:r._southWest.lng}};if(!angular.equals(t.bounds,i)){t.bounds=i}});l.$watch("bounds",function(r){if(!a(r)){e.error("[AngularJS - Leaflet] Invalid bounds");return}var s=f(r);if(s&&!n.getBounds().equals(s)){i.settingBoundsFromScope=true;n.fitBounds(s);t(function(){i.settingBoundsFromScope=false})}},true)})}}}]);angular.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults","leafletMarkersHelpers","leafletEvents",function(e,t,n,r,i,s,o,u){return{restrict:"A",scope:false,replace:false,require:["leaflet","?layers"],link:function(t,s,a,f){var l=f[0],c=i,h=i.isDefined,p=i.isString,d=l.getLeafletScope(),v=o.deleteMarker,m=o.addMarkerWatcher,g=o.listenMarkerEvents,y=o.addMarkerToGroup,b=u.bindMarkerEvents,w=o.createMarker;l.getMap().then(function(t){var i={},s;if(h(f[1])){s=f[1].getLayers}else{s=function(){var e=n.defer();e.resolve();return e.promise}}s().then(function(n){r.setMarkers(i,a.id);d.$watch("markers",function(r){for(var s in i){if(!h(r)||!h(r[s])){v(i[s],t,n);delete i[s]}}for(var o in r){if(o.search("-")!==-1){e.error('The marker can\'t use a "-" on his key name: "'+o+'".');continue}if(!h(i[o])){var u=r[o];var f=w(u);if(!h(f)){e.error("[AngularJS - Leaflet] Received invalid data on the marker "+o+".");continue}i[o]=f;if(h(u.message)){f.bindPopup(u.message,u.popupOptions)}if(h(u.group)){var l=h(u.groupOption)?u.groupOption:null;y(f,u.group,l,t)}if(c.LabelPlugin.isLoaded()&&h(u.label)&&h(u.label.message)){f.bindLabel(u.label.message,u.label.options)}if(h(u)&&h(u.layer)){if(!p(u.layer)){e.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!h(n)){e.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!h(n.overlays)||!h(n.overlays[u.layer])){e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var E=n.overlays[u.layer];if(!(E instanceof L.LayerGroup||E instanceof L.FeatureGroup)){e.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}E.addLayer(f);if(t.hasLayer(f)&&u.focus===true){f.openPopup()}}else if(!h(u.group)){t.addLayer(f);if(u.focus===true){f.openPopup()}if(c.LabelPlugin.isLoaded()&&h(u.label)&&h(u.label.options)&&u.label.options.noHide===true){f.showLabel()}}var S=!h(a.watchMarkers)||a.watchMarkers==="true";if(S){m(f,o,d,n,t);g(f,u,d)}b(f,o,u,d)}}},true)})})}}}]);angular.module("leaflet-directive").directive("paths",["$log","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletPathsHelpers","leafletEvents",function(e,t,n,r,i,s,o){return{restrict:"A",scope:false,replace:false,require:["leaflet","?layers"],link:function(u,a,f,l){var c=l[0],h=i.isDefined,p=i.isString,d=c.getLeafletScope(),v=d.paths,m=s.createPath,g=o.bindPathEvents,y=s.setPathOptions;c.getMap().then(function(s){var o=r.getDefaults(f.id),u;if(h(l[1])){u=l[1].getLayers}else{u=function(){var e=t.defer();e.resolve();return e.promise}}if(!h(v)){return}u().then(function(t){var r={};n.setPaths(r,f.id);var u=function(e,t){var n=d.$watch("paths."+t,function(t){if(!h(t)){s.removeLayer(e);n();return}y(e,t.type,t)},true)};d.$watch("paths",function(n){for(var a in n){if(a.search("\\$")===0){continue}if(a.search("-")!==-1){e.error('[AngularJS - Leaflet] The path name "'+a+'" is not valid. It must not include "-" and a number.');continue}if(!h(r[a])){var f=n[a];var l=m(a,n[a],o);if(h(l)&&h(f.message)){l.bindPopup(f.message)}if(i.LabelPlugin.isLoaded()&&h(f.label)&&h(f.label.message)){l.bindLabel(f.label.message,f.label.options)}if(h(f)&&h(f.layer)){if(!p(f.layer)){e.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!h(t)){e.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!h(t.overlays)||!h(t.overlays[f.layer])){e.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var c=t.overlays[f.layer];if(!(c instanceof L.LayerGroup||c instanceof L.FeatureGroup)){e.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}r[a]=l;c.addLayer(l);u(l,a)}else if(h(l)){r[a]=l;s.addLayer(l);u(l,a)}g(l,a,f,d)}}for(var v in r){if(!h(n[v])){delete r[v]}}},true)})})}}}]);angular.module("leaflet-directive").directive("controls",["$log","leafletHelpers",function(e,t){return{restrict:"A",scope:false,replace:false,require:"?^leaflet",link:function(e,n,r,i){if(!i){return}var s=t.isDefined,o=i.getLeafletScope(),u=o.controls;i.getMap().then(function(e){if(s(L.Control.Draw)&&s(u.draw)){var t=new L.FeatureGroup;var n={edit:{featureGroup:t}};angular.extend(n,u.draw);u.draw=n;e.addLayer(n.edit.featureGroup);var r=new L.Control.Draw(n);e.addControl(r)}if(s(u.custom)){for(var i in u.custom){e.addControl(u.custom[i])}}})}}}]);angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope","leafletHelpers","leafletEvents",function(e,t,n,r){return{restrict:"A",scope:false,replace:false,require:"leaflet",link:function(t,i,s,o){var u=n.isObject,a=o.getLeafletScope(),f=a.eventBroadcast,l=r.getAvailableMapEvents(),c=r.genDispatchMapEvent;o.getMap().then(function(t){var n=[];var r;var i;var s="broadcast";if(u(f)){if(f.map===undefined||f.map===null){n=l}else if(typeof f.map!=="object"){e.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.")}else{if(f.map.logic!==undefined&&f.map.logic!==null){if(f.map.logic!=="emit"&&f.map.logic!=="broadcast"){e.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'.")}else if(f.map.logic==="emit"){s="emit"}}var o=false,h=false;if(f.map.enable!==undefined&&f.map.enable!==null){if(typeof f.map.enable==="object"){o=true}}if(f.map.disable!==undefined&&f.map.disable!==null){if(typeof f.map.disable==="object"){h=true}}if(o&&h){e.warn("[AngularJS - Leaflet] can not enable and disable events at the time")}else if(!o&&!h){e.warn("[AngularJS - Leaflet] must enable or disable events")}else{if(o){for(r=0;r<f.map.enable.length;r++){i=f.map.enable[r];if(n.indexOf(i)!==-1){e.warn("[AngularJS - Leaflet] This event "+i+" is already enabled")}else{if(l.indexOf(i)===-1){e.warn("[AngularJS - Leaflet] This event "+i+" does not exist")}else{n.push(i)}}}}else{n=l;for(r=0;r<f.map.disable.length;r++){i=f.map.disable[r];var p=n.indexOf(i);if(p===-1){e.warn("[AngularJS - Leaflet] This event "+i+" does not exist or has been already disabled")}else{n.splice(p,1)}}}}}for(r=0;r<n.length;r++){i=n[r];t.on(i,c(a,i,s),{eventName:i})}}else{e.warn("[AngularJS - Leaflet] event-broadcast must be an object, check your model.")}})}}}]);angular.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults","leafletBoundsHelpers",function(e,t,n){return{restrict:"A",scope:false,replace:false,require:"leaflet",link:function(e,t,r,i){var s=i.getLeafletScope(),o=n.isValidBounds;i.getMap().then(function(e){s.$watch("maxbounds",function(t){if(!o(t)){e.setMaxBounds();return}var n=[[t.southWest.lat,t.southWest.lng],[t.northEast.lat,t.northEast.lng]];e.setMaxBounds(n);if(!r.center){e.fitBounds(n)}})})}}}]);angular.module("leaflet-directive").directive("decorations",["$log","leafletHelpers",function(e,t){return{restrict:"A",scope:false,replace:false,require:"leaflet",link:function(n,r,i,s){function l(t){if(a(t)&&a(t.coordinates)){if(!u.isLoaded()){e.error("[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.")}}return L.polylineDecorator(t.coordinates)}function c(e,t){if(a(e)&&a(t)){if(a(t.coordinates)&&a(t.patterns)){e.setPaths(t.coordinates);e.setPatterns(t.patterns);return e}}}var o=s.getLeafletScope(),u=t.PolylineDecoratorPlugin,a=t.isDefined,f={};s.getMap().then(function(e){o.$watch("decorations",function(t){for(var n in f){if(!a(t)||!a(t[n])){delete f[n]}e.removeLayer(f[n])}for(var r in t){var i=t[r],s=l(i);if(a(s)){f[r]=s;e.addLayer(s);c(s,i)}}},true)})}}}]);angular.module("leaflet-directive").directive("layercontrol",["$log","leafletData","leafletHelpers",function(e,t,n){return{restrict:"E",scope:{},replace:true,transclude:false,require:"^leaflet",controller:["$scope","$element","$sce",function(r,i,s){e.debug("[Angular Directive - Layers] layers",r,i);var o=n.safeApply,u=n.isDefined;angular.extend(r,{baselayer:"",icons:{uncheck:"fa fa-check-square-o",check:"fa fa-square-o",radio:"fa fa-dot-circle-o",unradio:"fa fa-circle-o",up:"fa fa-angle-up",down:"fa fa-angle-down",open:"fa fa-angle-double-down",close:"fa fa-angle-double-up"},changeBaseLayer:function(e,i){n.safeApply(r,function(n){n.baselayer=e;t.getMap().then(function(i){t.getLayers().then(function(t){if(i.hasLayer(t.baselayers[e])){return}for(var s in n.layers.baselayers){n.layers.baselayers[s].icon=n.icons.unradio;if(i.hasLayer(t.baselayers[s])){i.removeLayer(t.baselayers[s])}}i.addLayer(t.baselayers[e]);n.layers.baselayers[e].icon=r.icons.radio})})});i.preventDefault()},moveLayer:function(e,t,n){var i=Object.keys(r.layers.baselayers).length;if(t>=1+i&&t<=r.overlaysArray.length+i){var s;for(var u in r.layers.overlays){if(r.layers.overlays[u].index===t){s=r.layers.overlays[u];break}}if(s){o(r,function(){s.index=e.index;e.index=t})}}n.stopPropagation();n.preventDefault()},initIndex:function(e,t){var n=Object.keys(r.layers.baselayers).length;e.index=u(e.index)?e.index:t+n+1},toggleOpacity:function(t,n){e.debug("Event",t);if(n.visible){var i=angular.element(t.currentTarget);i.toggleClass(r.icons.close+" "+r.icons.open);i=i.parents(".lf-row").find(".lf-opacity");i.toggle("fast",function(){o(r,function(){n.opacityControl=!n.opacityControl})})}t.stopPropagation();t.preventDefault()},unsafeHTML:function(e){return s.trustAsHtml(e)}});var a=i.get(0);if(!L.Browser.touch){L.DomEvent.disableClickPropagation(a);L.DomEvent.on(a,"mousewheel",L.DomEvent.stopPropagation)}else{L.DomEvent.on(a,"click",L.DomEvent.stopPropagation)}}],template:'<div class="angular-leaflet-control-layers" ng-show="overlaysArray.length">'+'<div class="lf-baselayers">'+'<div class="lf-row" ng-repeat="(key, layer) in layers.baselayers">'+'<label class="lf-icon-bl" ng-click="changeBaseLayer(key, $event)">'+'<input class="leaflet-control-layers-selector" type="radio" name="lf-radio" '+'ng-show="false" ng-checked="baselayer === key" ng-value="key" /> '+'<i class="lf-icon lf-icon-radio" ng-class="layer.icon"></i>'+'<div class="lf-text">{{layer.name}}</div>'+"</label>"+"</div>"+"</div>"+'<div class="lf-overlays">'+'<div class="lf-container">'+'<div class="lf-row" ng-repeat="layer in overlaysArray | orderBy:\'index\':order" ng-init="initIndex(layer, $index)">'+'<label class="lf-icon-ol">'+'<input class="lf-control-layers-selector" type="checkbox" ng-show="false" ng-model="layer.visible"/> '+'<i class="lf-icon lf-icon-check" ng-class="layer.icon"></i>'+'<div class="lf-text">{{layer.name}}</div>'+'<div class="lf-icons">'+'<i class="lf-icon lf-up" ng-class="icons.up" ng-click="moveLayer(layer, layer.index - orderNumber, $event)"></i> '+'<i class="lf-icon lf-down" ng-class="icons.down" ng-click="moveLayer(layer, layer.index + orderNumber, $event)"></i> '+'<i class="lf-icon lf-open" ng-class="layer.opacityControl? icons.close:icons.open" ng-click="toggleOpacity($event, layer)"></i>'+"</div>"+"</label>"+'<div class="lf-legend" ng-if="layer.legend" ng-bind-html="unsafeHTML(layer.legend)"></div>'+'<div class="lf-opacity" ng-show="layer.visible && layer.opacityControl">'+'<input type="text" class="lf-opacity-control" name="lf-opacity-control" data-key="{{layer.index}}" />'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>",link:function(r,i,s,o){var u=n.isDefined,a=o.getLeafletScope(),f=a.layers;s.order=u(s.order)&&(s.order==="normal"||s.order==="reverse")?s.order:"normal";r.order=s.order==="normal";r.orderNumber=s.order==="normal"?-1:1;r.layers=f;o.getMap().then(function(n){if(!u(f)||!u(f.baselayers)||Object.keys(f.baselayers).length===0){e.error("[AngularJS - Leaflet] At least one baselayer has to be defined");return}a.$watch("layers.baselayers",function(e){t.getLayers().then(function(t){var i;for(i in e){if(n.hasLayer(t.baselayers[i])){e[i].icon=r.icons.radio}else{e[i].icon=r.icons.unradio}}})});a.$watch("layers.overlays",function(s){var o=[];t.getLayers().then(function(e){for(var t in s){s[t].icon=r.icons[s[t].visible?"uncheck":"check"];o.push(s[t]);if(u(s[t].index)&&e.overlays[t].setZIndex){e.overlays[t].setZIndex(s[t].index)}}});var a=r.$watch(function(){if(i.children().size()>1){i.find(".lf-overlays").trigger("resize");return i.find(".lf-opacity").size()===Object.keys(f.overlays).length}},function(s){if(s===true){if(u(i.find(".lf-opacity-control").ionRangeSlider)){i.find(".lf-opacity-control").each(function(e,i){var s=Object.keys(f.baselayers).length,o;for(var a in r.overlaysArray){if(r.overlaysArray[a].index===e+s+1){o=r.overlaysArray[a]}}var l=angular.element(i),c=u(o)&&u(o.layerOptions)?o.layerOptions.opacity:undefined;l.ionRangeSlider({min:0,from:u(c)?Math.ceil(c*100):100,step:1,max:100,prettify:false,hasGrid:false,hideMinMax:true,onChange:function(e){t.getLayers().then(function(t){var r=e.input.data().key;var i,s;for(var o in f.overlays){if(f.overlays[o].index===r){i=t.overlays[o];s=f.overlays[o];break}}if(n.hasLayer(i)){s.layerOptions=u(s.layerOptions)?s.layerOptions:{};s.layerOptions.opacity=e.input.val()/100;if(i.setOpacity){i.setOpacity(e.input.val()/100)}if(i.getLayers&&i.eachLayer){i.eachLayer(function(t){if(t.setOpacity){t.setOpacity(e.input.val()/100)}})}}})}})})}else{e.warn("[AngularJS - Leaflet] Ion Slide Range Plugin is not loaded")}a()}});r.overlaysArray=o},true)})}}}]);angular.module("leaflet-directive").service("leafletData",["$log","$q","leafletHelpers",function(e,t,n){var r=n.getDefer,i=n.getUnresolvedDefer,s=n.setResolvedDefer;var o={};var u={};var a={};var f={};var l={};var c={};var h={};var p={};this.setMap=function(e,t){var n=i(o,t);n.resolve(e);s(o,t)};this.getMap=function(e){var t=r(o,e);return t.promise};this.unresolveMap=function(e){var t=n.obtainEffectiveMapId(o,e);o[t]=undefined};this.getPaths=function(e){var t=r(f,e);return t.promise};this.setPaths=function(e,t){var n=i(f,t);n.resolve(e);s(f,t)};this.getMarkers=function(e){var t=r(l,e);return t.promise};this.setMarkers=function(e,t){var n=i(l,t);n.resolve(e);s(l,t)};this.getLayers=function(e){var t=r(a,e);return t.promise};this.setLayers=function(e,t){var n=i(a,t);n.resolve(e);s(a,t)};this.getUTFGrid=function(e){var t=r(h,e);return t.promise};this.setUTFGrid=function(e,t){var n=i(h,t);n.resolve(e);s(h,t)};this.setTiles=function(e,t){var n=i(u,t);n.resolve(e);s(u,t)};this.getTiles=function(e){var t=r(u,e);return t.promise};this.setGeoJSON=function(e,t){var n=i(c,t);n.resolve(e);s(c,t)};this.getGeoJSON=function(e){var t=r(c,e);return t.promise};this.setDecorations=function(e,t){var n=i(p,t);n.resolve(e);s(p,t)};this.getDecorations=function(e){var t=r(p,e);return t.promise}}]);angular.module("leaflet-directive").factory("leafletMapDefaults",["$q","leafletHelpers",function(e,t){function n(){return{keyboard:true,dragging:true,worldCopyJump:false,doubleClickZoom:true,scrollWheelZoom:true,touchZoom:true,zoomControl:true,zoomsliderControl:false,zoomControlPosition:"topleft",attributionControl:true,controls:{layers:{visible:true,position:"topright",collapsed:true}},crs:L.CRS.EPSG3857,tileLayer:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var r=t.isDefined,i=t.isObject,s=t.obtainEffectiveMapId,o={};return{getDefaults:function(e){var t=s(o,e);return o[t]},getMapCreationDefaults:function(e){var t=s(o,e);var n=o[t];var i={maxZoom:n.maxZoom,keyboard:n.keyboard,dragging:n.dragging,zoomControl:n.zoomControl,doubleClickZoom:n.doubleClickZoom,scrollWheelZoom:n.scrollWheelZoom,touchZoom:n.touchZoom,attributionControl:n.attributionControl,worldCopyJump:n.worldCopyJump,crs:n.crs};if(r(n.minZoom)){i.minZoom=n.minZoom}if(r(n.zoomAnimation)){i.zoomAnimation=n.zoomAnimation}if(r(n.fadeAnimation)){i.fadeAnimation=n.fadeAnimation}if(r(n.markerZoomAnimation)){i.markerZoomAnimation=n.markerZoomAnimation}if(n.map){for(var u in n.map){i[u]=n.map[u]}}return i},setDefaults:function(e,t){var u=n();if(r(e)){u.doubleClickZoom=r(e.doubleClickZoom)?e.doubleClickZoom:u.doubleClickZoom;u.scrollWheelZoom=r(e.scrollWheelZoom)?e.scrollWheelZoom:u.doubleClickZoom;u.touchZoom=r(e.touchZoom)?e.touchZoom:u.doubleClickZoom;u.zoomControl=r(e.zoomControl)?e.zoomControl:u.zoomControl;u.zoomsliderControl=r(e.zoomsliderControl)?e.zoomsliderControl:u.zoomsliderControl;u.attributionControl=r(e.attributionControl)?e.attributionControl:u.attributionControl;u.tileLayer=r(e.tileLayer)?e.tileLayer:u.tileLayer;u.zoomControlPosition=r(e.zoomControlPosition)?e.zoomControlPosition:u.zoomControlPosition;u.keyboard=r(e.keyboard)?e.keyboard:u.keyboard;u.dragging=r(e.dragging)?e.dragging:u.dragging;if(r(e.controls)){angular.extend(u.controls,e.controls)}if(i(e.crs)){u.crs=e.crs}else if(r(L.CRS[e.crs])){u.crs=L.CRS[e.crs]}if(r(e.tileLayerOptions)){angular.copy(e.tileLayerOptions,u.tileLayerOptions)}if(r(e.maxZoom)){u.maxZoom=e.maxZoom}if(r(e.minZoom)){u.minZoom=e.minZoom}if(r(e.zoomAnimation)){u.zoomAnimation=e.zoomAnimation}if(r(e.fadeAnimation)){u.fadeAnimation=e.fadeAnimation}if(r(e.markerZoomAnimation)){u.markerZoomAnimation=e.markerZoomAnimation}if(r(e.worldCopyJump)){u.worldCopyJump=e.worldCopyJump}if(r(e.map)){u.map=e.map}}var a=s(o,t);o[a]=u;return u}}}]);angular.module("leaflet-directive").factory("leafletEvents",["$rootScope","$q","$log","leafletHelpers",function(e,t,n,r){var i=r.safeApply,s=r.isDefined,o=r.isObject,u=r;var a=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu"]};var f=function(e,t,n,r){var i=a();var s="markers."+r;for(var o=0;o<i.length;o++){var u=i[o];n.label.on(u,h(e,u,t,n.label,s))}};var l=function(t,n,r,s,o,u){return function(a){var f="leafletDirectiveMarker."+t;if(t==="click"){i(r,function(){e.$broadcast("leafletDirectiveMarkersClick",o)})}else if(t==="dragend"){i(r,function(){u.lat=s.getLatLng().lat;u.lng=s.getLatLng().lng});if(u.message&&u.focus===true){s.openPopup()}}i(r,function(t){if(n==="emit"){t.$emit(f,{markerName:o,leafletEvent:a})}else{e.$broadcast(f,{markerName:o,leafletEvent:a})}})}};var c=function(t,n,r,s,o){return function(s){var u="leafletDirectivePath."+t;i(r,function(t){if(n==="emit"){t.$emit(u,{pathName:o,leafletEvent:s})}else{e.$broadcast(u,{pathName:o,leafletEvent:s})}})}};var h=function(t,n,r,s,o){return function(u){var a="leafletDirectiveLabel."+n;var f=o.replace("markers.","");i(t,function(t){if(r==="emit"){t.$emit(a,{leafletEvent:u,label:s,markerName:f})}else if(r==="broadcast"){e.$broadcast(a,{leafletEvent:u,label:s,markerName:f})}})}};var p=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"]};var d=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","add","remove","popupopen","popupclose"]};return{getAvailableMapEvents:function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose","draw:created","draw:edited","draw:deleted","draw:drawstart","draw:drawstop","draw:editstart","draw:editstop","draw:deletestart","draw:deletestop"]},genDispatchMapEvent:function(t,n,r){return function(s){var o="leafletDirectiveMap."+n;i(t,function(t){if(r==="emit"){t.$emit(o,{leafletEvent:s})}else if(r==="broadcast"){e.$broadcast(o,{leafletEvent:s})}})}},getAvailableMarkerEvents:p,getAvailablePathEvents:d,notifyCenterChangedToBounds:function(e){e.$broadcast("boundsChanged")},notifyCenterUrlHashChanged:function(e,t,n,r){if(!s(n.urlHashCenter)){return}var i=t.getCenter();var o=i.lat.toFixed(4)+":"+i.lng.toFixed(4)+":"+t.getZoom();if(!s(r.c)||r.c!==o){e.$emit("centerUrlHash",o)}},bindMarkerEvents:function(e,t,r,i){var a=[];var c;var h;var d="broadcast";if(!s(i.eventBroadcast)){a=p()}else if(!o(i.eventBroadcast)){n.error("[AngularJS - Leaflet] event-broadcast must be an object check your model.")}else{if(!s(i.eventBroadcast.marker)){a=p()}else if(!o(i.eventBroadcast.marker)){n.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.")}else{if(i.eventBroadcast.marker.logic!==undefined&&i.eventBroadcast.marker.logic!==null){if(i.eventBroadcast.marker.logic!=="emit"&&i.eventBroadcast.marker.logic!=="broadcast"){n.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'.")}else if(i.eventBroadcast.marker.logic==="emit"){d="emit"}}var v=false,m=false;if(i.eventBroadcast.marker.enable!==undefined&&i.eventBroadcast.marker.enable!==null){if(typeof i.eventBroadcast.marker.enable==="object"){v=true}}if(i.eventBroadcast.marker.disable!==undefined&&i.eventBroadcast.marker.disable!==null){if(typeof i.eventBroadcast.marker.disable==="object"){m=true}}if(v&&m){n.warn("[AngularJS - Leaflet] can not enable and disable events at the same time")}else if(!v&&!m){n.warn("[AngularJS - Leaflet] must enable or disable events")}else{if(v){for(c=0;c<i.eventBroadcast.marker.enable.length;c++){h=i.eventBroadcast.marker.enable[c];if(a.indexOf(h)!==-1){n.warn("[AngularJS - Leaflet] This event "+h+" is already enabled")}else{if(p().indexOf(h)===-1){n.warn("[AngularJS - Leaflet] This event "+h+" does not exist")}else{a.push(h)}}}}else{a=p();for(c=0;c<i.eventBroadcast.marker.disable.length;c++){h=i.eventBroadcast.marker.disable[c];var g=a.indexOf(h);if(g===-1){n.warn("[AngularJS - Leaflet] This event "+h+" does not exist or has been already disabled")}else{a.splice(g,1)}}}}}}for(c=0;c<a.length;c++){h=a[c];e.on(h,l(h,d,i,e,t,r))}if(u.LabelPlugin.isLoaded()&&s(e.label)){f(i,d,e,t)}},bindPathEvents:function(e,t,r,i){var a=[];var l;var h;var p="broadcast";if(!s(i.eventBroadcast)){a=d()}else if(!o(i.eventBroadcast)){n.error("[AngularJS - Leaflet] event-broadcast must be an object check your model.")}else{if(!s(i.eventBroadcast.path)){a=d()}else if(o(i.eventBroadcast.paths)){n.warn("[AngularJS - Leaflet] event-broadcast.path must be an object check your model.")}else{if(i.eventBroadcast.path.logic!==undefined&&i.eventBroadcast.path.logic!==null){if(i.eventBroadcast.path.logic!=="emit"&&i.eventBroadcast.path.logic!=="broadcast"){n.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'.")}else if(i.eventBroadcast.path.logic==="emit"){p="emit"}}var v=false,m=false;if(i.eventBroadcast.path.enable!==undefined&&i.eventBroadcast.path.enable!==null){if(typeof i.eventBroadcast.path.enable==="object"){v=true}}if(i.eventBroadcast.path.disable!==undefined&&i.eventBroadcast.path.disable!==null){if(typeof i.eventBroadcast.path.disable==="object"){m=true}}if(v&&m){n.warn("[AngularJS - Leaflet] can not enable and disable events at the same time")}else if(!v&&!m){n.warn("[AngularJS - Leaflet] must enable or disable events")}else{if(v){for(l=0;l<i.eventBroadcast.path.enable.length;l++){h=i.eventBroadcast.path.enable[l];if(a.indexOf(h)!==-1){n.warn("[AngularJS - Leaflet] This event "+h+" is already enabled")}else{if(d().indexOf(h)===-1){n.warn("[AngularJS - Leaflet] This event "+h+" does not exist")}else{a.push(h)}}}}else{a=d();for(l=0;l<i.eventBroadcast.path.disable.length;l++){h=i.eventBroadcast.path.disable[l];var g=a.indexOf(h);if(g===-1){n.warn("[AngularJS - Leaflet] This event "+h+" does not exist or has been already disabled")}else{a.splice(g,1)}}}}}}for(l=0;l<a.length;l++){h=a[l];e.on(h,c(h,p,i,a,t))}if(u.LabelPlugin.isLoaded()&&s(e.label)){f(i,p,e,t)}}}}]);angular.module("leaflet-directive").factory("leafletLayerHelpers",["$rootScope","$log","leafletHelpers",function($rootScope,$log,leafletHelpers){function isValidLayerType(e){if(!isString(e.type)){$log.error("[AngularJS - Leaflet] A layer must have a valid type defined.");return false}if(Object.keys(layerTypes).indexOf(e.type)===-1){$log.error("[AngularJS - Leaflet] A layer must have a valid type: "+Object.keys(layerTypes));return false}if(layerTypes[e.type].mustHaveUrl&&!isString(e.url)){$log.error("[AngularJS - Leaflet] A base layer must have an url");return false}if(layerTypes[e.type].mustHaveData&&!isDefined(e.data)){$log.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute');return false}if(layerTypes[e.type].mustHaveLayer&&!isDefined(e.layer)){$log.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have an layer defined");return false}if(layerTypes[e.type].mustHaveBounds&&!isDefined(e.bounds)){$log.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have bounds defined");return false}if(layerTypes[e.type].mustHaveKey&&!isDefined(e.key)){$log.error("[AngularJS - Leaflet] The type of layer "+e.type+" must have key defined");return false}return true}var Helpers=leafletHelpers,isString=leafletHelpers.isString,isObject=leafletHelpers.isObject,isDefined=leafletHelpers.isDefined;var utfGridCreateLayer=function(e){if(!Helpers.UTFGridPlugin.isLoaded()){$log.error("[AngularJS - Leaflet] The UTFGrid plugin is not loaded.");return}var t=new L.UtfGrid(e.url,e.pluginOptions);t.on("mouseover",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseover",e)});t.on("mouseout",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridMouseout",e)});t.on("click",function(e){$rootScope.$broadcast("leafletDirectiveMap.utfgridClick",e)});return t};var layerTypes={xyz:{mustHaveUrl:true,createLayer:function(e){return L.tileLayer(e.url,e.options)}},mapbox:{mustHaveKey:true,createLayer:function(e){var t="//{s}.tiles.mapbox.com/v3/"+e.key+"/{z}/{x}/{y}.png";return L.tileLayer(t,e.options)}},geoJSON:{mustHaveUrl:true,createLayer:function(e){if(!Helpers.GeoJSONPlugin.isLoaded()){return}return new L.TileLayer.GeoJSON(e.url,e.pluginOptions,e.options)}},utfGrid:{mustHaveUrl:true,createLayer:utfGridCreateLayer},cartodbTiles:{mustHaveKey:true,createLayer:function(e){var t="//"+e.user+".cartodb.com/api/v1/map/"+e.key+"/{z}/{x}/{y}.png";return L.tileLayer(t,e.options)}},cartodbUTFGrid:{mustHaveKey:true,mustHaveLayer:true,createLayer:function(e){e.url="//"+e.user+".cartodb.com/api/v1/map/"+e.key+"/"+e.layer+"/{z}/{x}/{y}.grid.json";return utfGridCreateLayer(e)}},cartodbInteractive:{mustHaveKey:true,mustHaveLayer:true,createLayer:function(e){var t="//"+e.user+".cartodb.com/api/v1/map/"+e.key+"/{z}/{x}/{y}.png";var n=L.tileLayer(t,e.options);e.url="//"+e.user+".cartodb.com/api/v1/map/"+e.key+"/"+e.layer+"/{z}/{x}/{y}.grid.json";var r=utfGridCreateLayer(e);return L.layerGroup([n,r])}},wms:{mustHaveUrl:true,createLayer:function(e){return L.tileLayer.wms(e.url,e.options)}},wmts:{mustHaveUrl:true,createLayer:function(e){return L.tileLayer.wmts(e.url,e.options)}},wfs:{mustHaveUrl:true,mustHaveLayer:true,createLayer:function(params){if(!Helpers.WFSLayerPlugin.isLoaded()){return}var options=angular.copy(params.options);if(options.crs&&"string"===typeof options.crs){options.crs=eval(options.crs)}return new L.GeoJSON.WFS(params.url,params.layer,options)}},group:{mustHaveUrl:false,createLayer:function(){return L.layerGroup()}},featureGroup:{mustHaveUrl:false,createLayer:function(){return L.featureGroup()}},google:{mustHaveUrl:false,createLayer:function(e){var t=e.type||"SATELLITE";if(!Helpers.GoogleLayerPlugin.isLoaded()){return}return new L.Google(t,e.options)}},china:{mustHaveUrl:false,createLayer:function(e){var t=e.type||"";if(!Helpers.ChinaLayerPlugin.isLoaded()){return}return L.tileLayer.chinaProvider(t,e.options)}},ags:{mustHaveUrl:true,createLayer:function(e){if(!Helpers.AGSLayerPlugin.isLoaded()){return}var t=angular.copy(e.options);angular.extend(t,{url:e.url});var n=new lvector.AGS(t);n.onAdd=function(e){this.setMap(e)};n.onRemove=function(){this.setMap(null)};return n}},dynamic:{mustHaveUrl:true,createLayer:function(e){if(!Helpers.DynamicMapLayerPlugin.isLoaded()){return}return L.esri.dynamicMapLayer(e.url,e.options)}},markercluster:{mustHaveUrl:false,createLayer:function(e){if(!Helpers.MarkerClusterPlugin.isLoaded()){$log.error("[AngularJS - Leaflet] The markercluster plugin is not loaded.");return}return new L.MarkerClusterGroup(e.options)}},bing:{mustHaveUrl:false,createLayer:function(e){if(!Helpers.BingLayerPlugin.isLoaded()){return}return new L.BingLayer(e.key,e.options)}},heatmap:{mustHaveUrl:false,mustHaveData:true,createLayer:function(e){if(!Helpers.HeatMapLayerPlugin.isLoaded()){return}var t=new L.TileLayer.WebGLHeatMap(e.options);if(isDefined(e.data)){t.setData(e.data)}return t}},yandex:{mustHaveUrl:false,createLayer:function(e){var t=e.type||"map";if(!Helpers.YandexLayerPlugin.isLoaded()){return}return new L.Yandex(t,e.options)}},imageOverlay:{mustHaveUrl:true,mustHaveBounds:true,createLayer:function(e){return L.imageOverlay(e.url,e.bounds,e.options)}},custom:{createLayer:function(e){if(e.layer instanceof L.Class){return angular.copy(e.layer)}else{$log.error("[AngularJS - Leaflet] A custom layer must be a leaflet Class")}}},cartodb:{mustHaveUrl:true,createLayer:function(e){return cartodb.createLayer(e.map,e.url)}}};return{createLayer:function(e){if(!isValidLayerType(e)){return}if(!isString(e.name)){$log.error("[AngularJS - Leaflet] A base layer must have a name");return}if(!isObject(e.layerParams)){e.layerParams={}}if(!isObject(e.layerOptions)){e.layerOptions={}}for(var t in e.layerParams){e.layerOptions[t]=e.layerParams[t]}var n={url:e.url,data:e.data,options:e.layerOptions,layer:e.layer,type:e.layerType,bounds:e.bounds,key:e.key,pluginOptions:e.pluginOptions,user:e.user};return layerTypes[e.type].createLayer(n)}}}]);angular.module("leaflet-directive").factory("leafletControlHelpers",["$rootScope","$log","leafletHelpers","leafletMapDefaults",function(e,t,n,r){var i=n.isObject,s=n.isDefined;var o;var u=function(e,t,n){var s=r.getDefaults(n);if(!s.controls.layers.visible){return false}var o=0;if(i(e)){o+=Object.keys(e).length}if(i(t)){o+=Object.keys(t).length}return o>1};var a=function(e){var t=r.getDefaults(e);var n={collapsed:t.controls.layers.collapsed,position:t.controls.layers.position};angular.extend(n,t.controls.layers.options);var i;if(t.controls.layers&&s(t.controls.layers.control)){i=t.controls.layers.control.apply(this,[[],[],n])}else{i=new L.control.layers([],[],n)}return i};return{layersControlMustBeVisible:u,updateLayersControl:function(e,t,n,r,i,f){var l;var c=u(r,i,t);if(s(o)&&n){for(l in f.baselayers){o.removeLayer(f.baselayers[l])}for(l in f.overlays){o.removeLayer(f.overlays[l])}o.removeFrom(e)}if(c){o=a(t);for(l in r){if(s(f.baselayers[l])){o.addBaseLayer(f.baselayers[l],r[l].name)}}for(l in i){if(s(f.overlays[l])){o.addOverlay(f.overlays[l],i[l].name)}}o.addTo(e)}return c}}}]);angular.module("leaflet-directive").factory("leafletLegendHelpers",function(){var e=function(e,t){e.innerHTML="";if(t.error){e.innerHTML+='<div class="info-title alert alert-danger">'+t.error.message+"</div>"}else{for(var n=0;n<t.layers.length;n++){var r=t.layers[n];e.innerHTML+='<div class="info-title" data-layerid="'+r.layerId+'">'+r.layerName+"</div>";for(var i=0;i<r.legend.length;i++){var s=r.legend[i];e.innerHTML+='<div class="inline" data-layerid="'+r.layerId+'"><img src="data:'+s.contentType+";base64,"+s.imageData+'" /></div>'+'<div class="info-label" data-layerid="'+r.layerId+'">'+s.label+"</div>"}}}};var t=function(t,n){return function(){var r=L.DomUtil.create("div",n);if(!L.Browser.touch){L.DomEvent.disableClickPropagation(r);L.DomEvent.on(r,"mousewheel",L.DomEvent.stopPropagation)}else{L.DomEvent.on(r,"click",L.DomEvent.stopPropagation)}e(r,t);return r}};var n=function(e,t){return function(){var n=L.DomUtil.create("div",t);for(var r=0;r<e.colors.length;r++){n.innerHTML+='<div class="outline"><i style="background:'+e.colors[r]+'"></i></div>'+'<div class="info-label">'+e.labels[r]+"</div>"}if(!L.Browser.touch){L.DomEvent.disableClickPropagation(n);L.DomEvent.on(n,"mousewheel",L.DomEvent.stopPropagation)}else{L.DomEvent.on(n,"click",L.DomEvent.stopPropagation)}return n}};return{getOnAddArcGISLegend:t,getOnAddArrayLegend:n,updateArcGISLegend:e}});angular.module("leaflet-directive").factory("leafletPathsHelpers",["$rootScope","$log","leafletHelpers",function(e,t,n){function a(e){return e.filter(function(e){return o(e)}).map(function(e){return f(e)})}function f(e){if(i(e)){return new L.LatLng(e[0],e[1])}else{return new L.LatLng(e.lat,e.lng)}}function l(e){return e.map(function(e){return a(e)})}function c(e,t){var n={};for(var i=0;i<u.length;i++){var s=u[i];if(r(e[s])){n[s]=e[s]}else if(r(t.path[s])){n[s]=t.path[s]}}return n}var r=n.isDefined,i=n.isArray,s=n.isNumber,o=n.isValidPoint;var u=["stroke","weight","color","opacity","fill","fillColor","fillOpacity","dashArray","lineCap","lineJoin","clickable","pointerEvents","className","smoothFactor","noClip"];var h=function(e,t){var n={};for(var i=0;i<u.length;i++){var s=u[i];if(r(t[s])){n[s]=t[s]}}e.setStyle(t)};var p=function(e){if(!i(e)){return false}for(var t=0;t<e.length;t++){var n=e[t];if(!o(n)){return false}}return true};var d={polyline:{isValid:function(e){var t=e.latlngs;return p(t)},createPath:function(e){return new L.Polyline([],e)},setPath:function(e,t){e.setLatLngs(a(t.latlngs));h(e,t);return}},multiPolyline:{isValid:function(e){var t=e.latlngs;if(!i(t)){return false}for(var n in t){var r=t[n];if(!p(r)){return false}}return true},createPath:function(e){return new L.multiPolyline([[[0,0],[1,1]]],e)},setPath:function(e,t){e.setLatLngs(l(t.latlngs));h(e,t);return}},polygon:{isValid:function(e){var t=e.latlngs;return p(t)},createPath:function(e){return new L.Polygon([],e)},setPath:function(e,t){e.setLatLngs(a(t.latlngs));h(e,t);return}},multiPolygon:{isValid:function(e){var t=e.latlngs;if(!i(t)){return false}for(var n in t){var r=t[n];if(!p(r)){return false}}return true},createPath:function(e){return new L.MultiPolygon([[[0,0],[1,1],[0,1]]],e)},setPath:function(e,t){e.setLatLngs(l(t.latlngs));h(e,t);return}},rectangle:{isValid:function(e){var t=e.latlngs;if(!i(t)||t.length!==2){return false}for(var n in t){var r=t[n];if(!o(r)){return false}}return true},createPath:function(e){return new L.Rectangle([[0,0],[1,1]],e)},setPath:function(e,t){e.setBounds(new L.LatLngBounds(a(t.latlngs)));h(e,t)}},circle:{isValid:function(e){var t=e.latlngs;return o(t)&&s(e.radius)},createPath:function(e){return new L.Circle([0,0],1,e)},setPath:function(e,t){e.setLatLng(f(t.latlngs));if(r(t.radius)){e.setRadius(t.radius)}h(e,t)}},circleMarker:{isValid:function(e){var t=e.latlngs;return o(t)&&s(e.radius)},createPath:function(e){return new L.CircleMarker([0,0],e)},setPath:function(e,t){e.setLatLng(f(t.latlngs));if(r(t.radius)){e.setRadius(t.radius)}h(e,t)}}};var v=function(e){var t={};if(e.latlngs){t.latlngs=e.latlngs}if(e.radius){t.radius=e.radius}return t};return{setPathOptions:function(e,t,n){if(!r(t)){t="polyline"}d[t].setPath(e,n)},createPath:function(e,n,i){if(!r(n.type)){n.type="polyline"}var s=c(n,i);var o=v(n);if(!d[n.type].isValid(o)){t.error("[AngularJS - Leaflet] Invalid data passed to the "+n.type+" path");return}return d[n.type].createPath(s)}}}]);angular.module("leaflet-directive").factory("leafletBoundsHelpers",["$log","leafletHelpers",function(e,t){function i(e){return angular.isDefined(e)&&angular.isDefined(e.southWest)&&angular.isDefined(e.northEast)&&angular.isNumber(e.southWest.lat)&&angular.isNumber(e.southWest.lng)&&angular.isNumber(e.northEast.lat)&&angular.isNumber(e.northEast.lng)}var n=t.isArray,r=t.isNumber;return{createLeafletBounds:function(e){if(i(e)){return L.latLngBounds([e.southWest.lat,e.southWest.lng],[e.northEast.lat,e.northEast.lng])}},isValidBounds:i,createBoundsFromArray:function(t){if(!(n(t)&&t.length===2&&n(t[0])&&n(t[1])&&t[0].length===2&&t[1].length===2&&r(t[0][0])&&r(t[0][1])&&r(t[1][0])&&r(t[1][1]))){e.error("[AngularJS - Leaflet] The bounds array is not valid.");return}return{northEast:{lat:t[0][0],lng:t[0][1]},southWest:{lat:t[1][0],lng:t[1][1]}}}}}]);angular.module("leaflet-directive").factory("leafletMarkersHelpers",["$rootScope","leafletHelpers","$log",function(e,t,n){var r=t.isDefined,i=t.MarkerClusterPlugin,s=t.AwesomeMarkersPlugin,o=t.MakiMarkersPlugin,u=t.safeApply,a=t,f=t.isString,l=t.isNumber,c=t.isObject,h={};var p=function(e){if(r(e)&&r(e.type)&&e.type==="awesomeMarker"){if(!s.isLoaded()){n.error("[AngularJS - Leaflet] The AwesomeMarkers Plugin is not loaded.")}return new L.AwesomeMarkers.icon(e)}if(r(e)&&r(e.type)&&e.type==="makiMarker"){if(!o.isLoaded()){n.error("[AngularJS - Leaflet] The MakiMarkers Plugin is not loaded.")}return new L.MakiMarkers.icon(e)}if(r(e)&&r(e.type)&&e.type==="div"){return new L.divIcon(e)}var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==";var i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=";if(!r(e)){return new L.Icon.Default({iconUrl:t,shadowUrl:i})}if(!r(e.iconUrl)){e.iconUrl=t;e.shadowUrl=i}return new L.Icon(e)};var d=function(e){if(r(h[e])){h.splice(e,1)}};var v=function(){h={}};var m=function(e,t,n){e.closePopup();if(r(n)&&r(n.overlays)){for(var i in n.overlays){if(n.overlays[i]instanceof L.LayerGroup||n.overlays[i]instanceof L.FeatureGroup){if(n.overlays[i].hasLayer(e)){n.overlays[i].removeLayer(e);return}}}}if(r(h)){for(var s in h){if(h[s].hasLayer(e)){h[s].removeLayer(e)}}}if(t.hasLayer(e)){t.removeLayer(e)}};return{resetMarkerGroup:d,resetMarkerGroups:v,deleteMarker:m,createMarker:function(e){if(!r(e)){n.error("[AngularJS - Leaflet] The marker definition is not valid.");return}var t={icon:p(e.icon),title:r(e.title)?e.title:"",draggable:r(e.draggable)?e.draggable:false,clickable:r(e.clickable)?e.clickable:true,riseOnHover:r(e.riseOnHover)?e.riseOnHover:false,zIndexOffset:r(e.zIndexOffset)?e.zIndexOffset:0,iconAngle:r(e.iconAngle)?e.iconAngle:0};for(var i in e){if(e.hasOwnProperty(i)&&!t.hasOwnProperty(i)){t[i]=e[i]}}var s=new L.marker(e,t);if(!f(e.message)){s.unbindPopup()}return s},addMarkerToGroup:function(e,t,s,o){if(!f(t)){n.error("[AngularJS - Leaflet] The marker group you have specified is invalid.");return}if(!i.isLoaded()){n.error("[AngularJS - Leaflet] The MarkerCluster plugin is not loaded.");return}if(!r(h[t])){h[t]=new L.MarkerClusterGroup(s);o.addLayer(h[t])}h[t].addLayer(e)},listenMarkerEvents:function(e,t,n){e.on("popupopen",function(){u(n,function(){t.focus=true})});e.on("popupclose",function(){u(n,function(){t.focus=false})})},addMarkerWatcher:function(e,t,i,s,o){var u=i.$watch('markers["'+t+'"]',function(t,i){if(!r(t)){m(e,o,s);u();return}if(!r(i)){return}if(!(l(t.lat)&&l(t.lng))){n.warn("There are problems with lat-lng data, please verify your marker model");m(e,o,s);return}if(!f(t.layer)){if(f(i.layer)){if(r(s.overlays[i.layer])&&s.overlays[i.layer].hasLayer(e)){s.overlays[i.layer].removeLayer(e);e.closePopup()}if(!o.hasLayer(e)){o.addLayer(e)}}}if(f(t.layer)&&i.layer!==t.layer){if(f(i.layer)&&r(s.overlays[i.layer])&&s.overlays[i.layer].hasLayer(e)){s.overlays[i.layer].removeLayer(e)}e.closePopup();if(o.hasLayer(e)){o.removeLayer(e)}if(!r(s.overlays[t.layer])){n.error("[AngularJS - Leaflet] You must use a name of an existing layer");return}var h=s.overlays[t.layer];if(!(h instanceof L.LayerGroup||h instanceof L.FeatureGroup)){n.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group" or "featureGroup"');return}h.addLayer(e);if(o.hasLayer(e)&&t.focus===true){e.openPopup()}}if(t.draggable!==true&&i.draggable===true&&r(e.dragging)){e.dragging.disable()}if(t.draggable===true&&i.draggable!==true){if(e.dragging){e.dragging.enable()}else{if(L.Handler.MarkerDrag){e.dragging=new L.Handler.MarkerDrag(e);e.options.draggable=true;e.dragging.enable()}}}if(!c(t.icon)){if(c(i.icon)){e.setIcon(p());e.closePopup();e.unbindPopup();if(f(t.message)){e.bindPopup(t.message,t.popupOptions)}}}if(c(t.icon)&&c(i.icon)&&!angular.equals(t.icon,i.icon)){var d=false;if(e.dragging){d=e.dragging.enabled()}e.setIcon(p(t.icon));if(d){e.dragging.enable()}e.closePopup();e.unbindPopup();if(f(t.message)){e.bindPopup(t.message,t.popupOptions)}}if(!f(t.message)&&f(i.message)){e.closePopup();e.unbindPopup()}if(a.LabelPlugin.isLoaded()&&r(t.label)&&r(t.label.message)&&!angular.equals(t.label.message,i.label.message)){e.updateLabelContent(t.label.message)}if(f(t.message)&&!f(i.message)){e.bindPopup(t.message,t.popupOptions);if(t.focus===true){e.openPopup()}}if(l(t.opacity)&&l(i.opacity)&&t.opacity!==i.opacity){e.setOpacity(t.opacity)}if(f(t.message)&&f(i.message)&&t.message!==i.message){e.setPopupContent(t.message)}var v=false;if(t.focus!==true&&i.focus===true){e.closePopup();v=true}if(t.focus===true&&i.focus!==true){e.openPopup();v=true}if(i.focus===true&&t.focus===true){e.openPopup();v=true}if(i.zIndexOffset!==t.zIndexOffset){e.setZIndexOffset(t.zIndexOffset)}var g=e.getLatLng();var y=f(t.layer)&&a.MarkerClusterPlugin.is(s.overlays[t.layer]);if(y){if(v){if(t.lat!==i.lat||t.lng!==i.lng){s.overlays[t.layer].removeLayer(e);e.setLatLng([t.lat,t.lng]);s.overlays[t.layer].addLayer(e)}}else{if(g.lat!==t.lat||g.lng!==t.lng){s.overlays[t.layer].removeLayer(e);e.setLatLng([t.lat,t.lng]);s.overlays[t.layer].addLayer(e)}else if(t.lat!==i.lat||t.lng!==i.lng){s.overlays[t.layer].removeLayer(e);e.setLatLng([t.lat,t.lng]);s.overlays[t.layer].addLayer(e)}else if(c(t.icon)&&c(i.icon)&&!angular.equals(t.icon,i.icon)){s.overlays[t.layer].removeLayer(e);s.overlays[t.layer].addLayer(e)}}}else if(g.lat!==t.lat||g.lng!==t.lng){e.setLatLng([t.lat,t.lng])}},true)}}}]);angular.module("leaflet-directive").factory("leafletHelpers",["$q","$log",function(e,t){function n(e,n){var r,i;if(!angular.isDefined(n)){if(Object.keys(e).length===0){r="main"}else if(Object.keys(e).length>=1){for(i in e){if(e.hasOwnProperty(i)){r=i}}}else if(Object.keys(e).length===0){r="main"}else{t.error("[AngularJS - Leaflet] - You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call")}}else{r=n}return r}function r(t,r){var i=n(t,r),s;if(!angular.isDefined(t[i])||t[i].resolvedDefer===true){s=e.defer();t[i]={defer:s,resolvedDefer:false}}else{s=t[i].defer}return s}return{isEmpty:function(e){return Object.keys(e).length===0},isUndefinedOrEmpty:function(e){return angular.isUndefined(e)||e===null||Object.keys(e).length===0},isDefined:function(e){return angular.isDefined(e)&&e!==null},isNumber:function(e){return angular.isNumber(e)},isString:function(e){return angular.isString(e)},isArray:function(e){return angular.isArray(e)},isObject:function(e){return angular.isObject(e)},isFunction:function(e){return angular.isFunction(e)},equals:function(e,t){return angular.equals(e,t)},isValidCenter:function(e){return angular.isDefined(e)&&angular.isNumber(e.lat)&&angular.isNumber(e.lng)&&angular.isNumber(e.zoom)},isValidPoint:function(e){if(!angular.isDefined(e)){return false}if(angular.isArray(e)){return e.length===2&&angular.isNumber(e[0])&&angular.isNumber(e[1])}return angular.isNumber(e.lat)&&angular.isNumber(e.lng)},isSameCenterOnMap:function(e,t){var n=t.getCenter();var r=t.getZoom();if(e.lat&&e.lng&&n.lat.toFixed(4)===e.lat.toFixed(4)&&n.lng.toFixed(4)===e.lng.toFixed(4)&&r===e.zoom){return true}return false},safeApply:function(e,t){var n=e.$root.$$phase;if(n==="$apply"||n==="$digest"){e.$eval(t)}else{e.$apply(t)}},obtainEffectiveMapId:n,getDefer:function(e,t){var i=n(e,t),s;if(!angular.isDefined(e[i])||e[i].resolvedDefer===false){s=r(e,t)}else{s=e[i].defer}return s},getUnresolvedDefer:r,setResolvedDefer:function(e,t){var r=n(e,t);e[r].resolvedDefer=true},AwesomeMarkersPlugin:{isLoaded:function(){if(angular.isDefined(L.AwesomeMarkers)&&angular.isDefined(L.AwesomeMarkers.Icon)){return true}else{return false}},is:function(e){if(this.isLoaded()){return e instanceof L.AwesomeMarkers.Icon}else{return false}},equal:function(e,t){if(!this.isLoaded()){return false}if(this.is(e)){return angular.equals(e,t)}else{return false}}},PolylineDecoratorPlugin:{isLoaded:function(){if(angular.isDefined(L.PolylineDecorator)){return true}else{return false}},is:function(e){if(this.isLoaded()){return e instanceof L.PolylineDecorator}else{return false}},equal:function(e,t){if(!this.isLoaded()){return false}if(this.is(e)){return angular.equals(e,t)}else{return false}}},MakiMarkersPlugin:{isLoaded:function(){if(angular.isDefined(L.MakiMarkers)&&angular.isDefined(L.MakiMarkers.Icon)){return true}else{return false}},is:function(e){if(this.isLoaded()){return e instanceof L.MakiMarkers.Icon}else{return false}},equal:function(e,t){if(!this.isLoaded()){return false}if(this.is(e)){return angular.equals(e,t)}else{return false}}},LabelPlugin:{isLoaded:function(){return angular.isDefined(L.Label)},is:function(e){if(this.isLoaded()){return e instanceof L.MarkerClusterGroup}else{return false}}},MarkerClusterPlugin:{isLoaded:function(){return angular.isDefined(L.MarkerClusterGroup)},is:function(e){if(this.isLoaded()){return e instanceof L.MarkerClusterGroup}else{return false}}},GoogleLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Google)},is:function(e){if(this.isLoaded()){return e instanceof L.Google}else{return false}}},ChinaLayerPlugin:{isLoaded:function(){return angular.isDefined(L.tileLayer.chinaProvider)}},HeatMapLayerPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.WebGLHeatMap)}},BingLayerPlugin:{isLoaded:function(){return angular.isDefined(L.BingLayer)},is:function(e){if(this.isLoaded()){return e instanceof L.BingLayer}else{return false}}},WFSLayerPlugin:{isLoaded:function(){return L.GeoJSON.WFS!==undefined},is:function(e){if(this.isLoaded()){return e instanceof L.GeoJSON.WFS}else{return false}}},AGSLayerPlugin:{isLoaded:function(){return lvector!==undefined&&lvector.AGS!==undefined},is:function(e){if(this.isLoaded()){return e instanceof lvector.AGS}else{return false}}},YandexLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Yandex)},is:function(e){if(this.isLoaded()){return e instanceof L.Yandex}else{return false}}},DynamicMapLayerPlugin:{isLoaded:function(){return L.esri!==undefined&&L.esri.dynamicMapLayer!==undefined},is:function(e){if(this.isLoaded()){return e instanceof L.esri.dynamicMapLayer}else{return false}}},GeoJSONPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.GeoJSON)},is:function(e){if(this.isLoaded()){return e instanceof L.TileLayer.GeoJSON}else{return false}}},UTFGridPlugin:{isLoaded:function(){return angular.isDefined(L.UtfGrid)},is:function(e){if(this.isLoaded()){return e instanceof L.UtfGrid}else{t.error("[AngularJS - Leaflet] No UtfGrid plugin found.");return false}}},CartoDB:{isLoaded:function(){return cartodb},is:function(){return true}},Leaflet:{DivIcon:{is:function(e){return e instanceof L.DivIcon},equal:function(e,t){if(this.is(e)){return angular.equals(e,t)}else{return false}}},Icon:{is:function(e){return e instanceof L.Icon},equal:function(e,t){if(this.is(e)){return angular.equals(e,t)}else{return false}}}}}}])})()
